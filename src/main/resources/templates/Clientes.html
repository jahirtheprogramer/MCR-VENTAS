<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Gestión de Clientes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f1f8e9;
      }

      .container {
        max-width: 800px;
        margin-top: 40px;
      }

      .card {
        box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.05);
      }

      .btn-danger {
        margin-left: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="text-center mb-4">
        <h1 class="text-success">
          <i class="bi bi-person-lines-fill"></i> Gestión de Clientes
        </h1>
      </div>

      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title mb-3">Registrar nuevo cliente</h5>
          <form id="clienteForm" class="row g-3">
            <div class="col-md-6">
              <input
                type="text"
                id="nombre"
                class="form-control"
                placeholder="Nombre del cliente"
                required
              />
            </div>
            <div class="col-md-6">
              <input
                type="email"
                id="email"
                class="form-control"
                placeholder="Correo electrónico"
                required
              />
            </div>
            <div class="col-md-6">
              <input
                type="text"
                id="telefono"
                class="form-control"
                placeholder="Teléfono"
                required
              />
            </div>
            <div class="col-md-6">
              <input
                type="text"
                id="empresa"
                class="form-control"
                placeholder="Empresa"
                required
              />
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-success w-100">
                <i class="bi bi-person-plus-fill"></i> Registrar Cliente
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Listado de Clientes</h5>
          <ul class="list-group" id="listaClientes">
            <!-- Clientes se agregan aquí dinámicamente -->
          </ul>
        </div>
      </div>

      <div class="text-center mt-4">
        <a href="/" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left-circle"></i> Volver al Inicio
        </a>
      </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      (async function () {
        const url = "/api/clientes";

        document
          .getElementById("clienteForm")
          .addEventListener("submit", async (e) => {
            e.preventDefault();

            const nombre = document.getElementById("nombre").value;
            const email = document.getElementById("email").value;
            const telefono = document.getElementById("telefono").value;
            const empresa = document.getElementById("empresa").value;

            try {
              const response = await fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  nombre,
                  correo: email,
                  telefono,
                  empresa,
                }),
              });

              if (!response.ok) throw new Error("Error al registrar cliente");

              document.getElementById("clienteForm").reset();
              await cargarClientes();
            } catch (error) {
              console.error("Error en el registro:", error);
              alert("Hubo un error al registrar el cliente.");
            }
          });

        async function cargarClientes() {
          try {
            const res = await fetch(url);
            const clientes = await res.json();
            const lista = document.getElementById("listaClientes");
            lista.innerHTML = "";

            clientes.forEach((cliente) => {
              const li = document.createElement("li");
              li.className =
                "list-group-item d-flex justify-content-between align-items-center";
              li.innerHTML = `
                <div>
                  <strong>${cliente.nombre}</strong><br />
                  <small>${cliente.correo}, ${cliente.telefono}, ${cliente.empresa}</small>
                </div>
                <button class="btn btn-sm btn-danger">
                  <i class="bi bi-trash-fill"></i>
                </button>
              `;

              li.querySelector("button").onclick = async () => {
                await fetch(`${url}/${cliente.id}`, { method: "DELETE" });
                await cargarClientes();
              };

              lista.appendChild(li);
            });
          } catch (error) {
            console.error("Error al cargar clientes:", error);
          }
        }

        await cargarClientes();
      })();
    </script>
  </body>
</html>
